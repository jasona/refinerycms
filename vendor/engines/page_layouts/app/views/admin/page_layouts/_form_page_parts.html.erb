<div id='page-tabs' class='clearfix ui-tabs ui-widget ui-widget-content ui-corner-all'>
  <ul id='page_parts'>
  <% @page.parts.each_with_index do |part, part_index| %>
    <li class='ui-state-default<%= ' ui-state-active' if part_index == 0 %>'>
      <%= link_to part.title, "##{@page.new_record? ? "page_part_new_#{part_index}" : part.to_param}" %>
    </li>
  <% end %>
  <% Refinery::Pages.tabs.each_with_index do |tab, tab_index| %>
    <li class='ui-state-default' id="custom_<%= tab.name %>_tab">
      <%= link_to tab.name.titleize, "#custom_tab_#{tab_index}" %>
    </li>
  <% end %>
  </ul>

  <div id='page_part_editors'>
    <% part_index = -1 %>
    <%= f.fields_for :parts do |p| %>
      <%= render :partial => 'page_part_field',
                 :locals => {
                   :part => p.object,
                   :part_index => (part_index += 1),
                   :new_part => @page.new_record?
                 } -%>
    <% end %>
    <% Refinery::Pages.tabs.each_with_index do |tab, tab_index| %>
      <div class='page_part' id='<%= "custom_tab_#{tab_index}" %>'>
        <%= render :partial => tab.partial, :locals => {:f => f} %>
      </div>
    <% end %>
  </div>
</div>
