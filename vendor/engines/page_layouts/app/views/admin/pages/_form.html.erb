<% url_opts = action_name == 'edit' ? {:url => admin_page_path(@page.id)} : {} %>
<%= form_for [:admin, @page], url_opts do |f| %>
<%= f.hidden_field :page_layout_id, :value => params[:layout_id] if @page.new_record? %>

  <%= render :partial => "/shared/admin/error_messages",
             :locals => {
               :object => @page,
               :include_object_name => true
             } %>

  <div class="field">
    <%= f.label :title %>
    <%= f.text_field :title, :class => "larger widest" %>
  </div>

  <%= render :partial => "form_fields_after_title",
             :locals => {
               :f => f
             } %>

  <div class='field'>
    <%= render :partial => "form_page_parts",
               :locals => {
                 :f => f
               } %>
  </div>

  <%= render :partial => "form_advanced_options",
             :locals => {
                :f => f
              } %>

  <%= render :partial => "/shared/admin/form_actions",
             :locals => {
               :f => f,
               :continue_editing => true,
               :delete_title => t('admin.pages.delete'),
               :delete_confirmation => t('shared.admin.delete.message', :title => @page.title)
             } %>
<% end %>

<% content_for :after_javascript_libraries do %>
  <script type='text/javascript'>
    $(document).ready(function(){
      page_options.init_with_layouts (
        <%= raw @page_layouts.to_json %>
        , <%= @page.layout.try(:id) %>
        , "<%= migrate_layout_admin_page_url(@page) unless @page.new_record? %>"
      );
    });
  </script>
<% end %>
